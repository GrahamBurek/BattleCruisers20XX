<!DOCTYPE HTML>
<html lang="en-US">
    <head>
        <meta charset="UTF-8">
        <title>Battle Cruisers 20XX</title>
        <style>
            body {
                background-color: #6699ff;
            }
            
            #instructions {
                width: 10em; height: 5em; font-size: 22px;
            }
            #retry {
                width: 10em; height: 5em; font-size: 22px;
            }
            
            canvas {
                padding-left: 0;
                padding-right: 0;
                margin-left: auto;
                margin-right: auto;
                display: block;
                width: 1600px;
            }
        </style>
        <script type="text/javascript"
        src = "simpleGame.js"></script>
        <script type="text/javascript">

            //music files
            var lasermp3;
            var laserogg;
            var bgmmp3;
            var bgmogg;
            var winSounds;
            var hitmarker;
            var y = 0;
            var game;
            var ship1;
            var ship2;
            var background;
            var redbullet;
            var bluebullet;
            var ship1time;
            var ship2time;
            var asteroid1;
            var redBulletBounces = 0.0;
            var blueBulletBounces = 0;
            var redCharge = 0;
            var blueCharge = 0;

            buildSounds = function () {
                lasermp3 = new Sound("music/laser.mp3");
                laserogg = new Sound("music/laser.ogg");
                bgmmp3 = new Sound("music/bgm.mp3");
                hitmarker = new Sound("music/hitmarker.mp3");
                winSounds = new Array(new Sound("music/airporn.mp3"), new Sound("music/barely.mp3"), 
                new Sound("music/i_eat_pears.mp3"), new Sound("music/illuminati_confirmed.mp3"),
                new Sound("music/im_legally_blind.mp3"), new Sound("music/im_not_a_rapper.mp3"), 
                new Sound("music/my_name_jeff.mp3"), new Sound("music/oh_baby_a_triple.mp3"),
                new Sound("music/really_nigga.mp3"), new Sound("music/smoke_weed_everyday.mp3"),
                new Sound("music/u_wot_m8.mp3"), new Sound("music/whatcha_say.mp3"), new Sound("music/where_dey_at_doe.mp3"),
                new Sound("music/wow.mp3"), new Sound("music/singsing.mp3"));
            }

            function RedBullet(owner) {
                //owner is the ship owning this bullet
                ship1time = new Timer();
                redbullet = new Sprite(game, "redbullet.png", 60, 30);
                redbullet.owner = owner;
                redbullet.hide();
                redbullet.setBoundAction(BOUNCE);
                //if(tBullet.collidesWith(asteroid))

                redbullet.fire = function () {
                    lasermp3.play();
                    laserogg.play();
                    ship1time.reset();
                    this.setPosition(this.owner.x, this.owner.y);
                    this.setMoveAngle(this.owner.getImgAngle());
                    this.setImgAngle(this.owner.getImgAngle());
                    this.setSpeed(40);
                    this.show();
                    //this.startTrail();
                } // end fire
                redbullet.checkCollisions = function () {
                    if (redbullet.collidesWith(asteroid1)) {
                        redbullet.dy *= -1;
                        redbullet.dx *= -1;
                        redbullet.calcSpeedAngle();
                        redbullet.imgAngle = redbullet.moveAngle;
                        redBulletBounces--;
                        if (redBulletBounces <= 0) {
                            redbullet.hide();
                        }

                    }
                    if (redbullet.collidesWith(ship2)) {
                        ship2.hide();
                        gameEnd();
                    }
                }

                redbullet.checkBounds = function () {

                    offRight = false;
                    offLeft = false;
                    offTop = false;
                    offBottom = false;

                    if (this.x > rightBorder) {
                        offRight = true;
                    }

                    if (this.x < leftBorder) {
                        offLeft = true;
                    }

                    if (this.y > bottomBorder) {
                        offBottom = true;
                    }

                    if (this.y < 0) {
                        offTop = true;
                    }

                    if (this.boundAction == BOUNCE) {
                        if (offTop || offBottom) {
                            this.dy *= -1;
                            this.calcSpeedAngle();
                            this.imgAngle = this.moveAngle;
                            if (this.visible == true) {
                                redBulletBounces--;
                                if (redBulletBounces <= 0) {
                                    redbullet.hide();
                                }
                            }
                        }

                        if (offLeft || offRight) {
                            this.dx *= -1;
                            this.calcSpeedAngle();
                            this.imgAngle = this.moveAngle;
                            if (this.visible == true) {
                                redBulletBounces--;
                                if (redBulletBounces <= 0) {
                                    redbullet.hide();
                                }
                            }
                        }
                    }
                }
                return redbullet;
            } // end bullet

            function BlueBullet(owner) {
                //owner is the ship owning this bullet
                ship2time = new Timer();
                bluebullet = new Sprite(game, "redbullet.png", 60, 30);
                bluebullet.owner = owner;
                bluebullet.hide();
                bluebullet.setBoundAction(BOUNCE);
                //if(tBullet.collidesWith(asteroid))
                bluebullet.fire = function () {
                    lasermp3.play();
                    laserogg.play();
                    ship2time.reset();
                    this.setPosition(this.owner.x, this.owner.y);
                    this.setMoveAngle(this.owner.getImgAngle());
                    this.setImgAngle(this.owner.getImgAngle());
                    this.setSpeed(40);
                    this.show();
                    //this.startTrail();
                } // end fire

                bluebullet.checkCollisions = function () {
                    if (bluebullet.collidesWith(asteroid1)) {
                        bluebullet.dy *= -1;
                        bluebullet.dx *= -1;
                        bluebullet.calcSpeedAngle();
                        bluebullet.imgAngle = redbullet.moveAngle;
                        blueBulletBounces--;
                        if (blueBulletBounces <= 0) {
                            bluebullet.hide();
                        }
                    }
                    if (bluebullet.collidesWith(ship1)) {
                        ship1.hide();
                        gameEnd();
                    }
                }
                bluebullet.checkBounds = function () {

                    offRight = false;
                    offLeft = false;
                    offTop = false;
                    offBottom = false;

                    if (this.x > rightBorder) {
                        offRight = true;
                    }

                    if (this.x < leftBorder) {
                        offLeft = true;
                    }

                    if (this.y > bottomBorder) {
                        offBottom = true;
                    }

                    if (this.y < 0) {
                        offTop = true;
                    }

                    if (this.boundAction == BOUNCE) {
                        if (offTop || offBottom) {
                            this.dy *= -1;
                            this.calcSpeedAngle();
                            this.imgAngle = this.moveAngle;
                            if (this.visible == true) {
                                blueBulletBounces--;
                                if (blueBulletBounces <= 0) {
                                    bluebullet.hide();
                                }
                            }
                        }

                        if (offLeft || offRight) {
                            this.dx *= -1;
                            this.calcSpeedAngle();
                            this.imgAngle = this.moveAngle;
                            if (this.visible == true) {
                                blueBulletBounces--;
                                if (blueBulletBounces <= 0) {
                                    bluebullet.hide();
                                }
                            }
                        }
                    }
                }
                return bluebullet;
            }

            function asteroid() {
                asteroid1 = new Sprite(game, "asteroids4.png", 100, 100);
                asteroid1.setPosition(400, 350);
                asteroid1.setSpeed(0);
                return asteroid1;
            }
            function Ship1() {
                ship1 = new Sprite(game, "space.png", 50, 25);
                ship1.setSpeed(0);
                ship1.setPosition(100, 550);
                ship1.setBoundAction(BOUNCE);
                ship1.bullet = new RedBullet(ship1);
                ship1.checkCollisions = function () {
                    if (ship1.collidesWith(asteroid1)) {
                        ship1.dy *= -1;
                        ship1.dx *= -1;
                        ship1.calcSpeedAngle();
                        ship1.imgAngle = ship1.moveAngle;
                        //prevents ship from getting stuck on asteroid bounce
                        ship1.changeSpeedBy(1);
                    }


                }
                ship1.checkKeys = function () {
                    if (keysDown[K_A]) {
                        this.changeImgAngleBy(-5);
                    }
                    if (keysDown[K_D]) {
                        this.changeImgAngleBy(5);
                        //this.changeAngleBy(10);
                    }
                    if (keysDown[K_W]) {
                        if (this.getSpeed() < 30) {
                            this.addVector(this.getImgAngle(), 2);
                        }
                        // end if
                    }
                    if (keysDown[K_S]) {
                        if (ship1time.getElapsedTime() > 2) {
                            if (redCharge < 30) {
                                redCharge++;
                            }
                        }
                    } else if (redCharge != 0) {
                        redBulletBounces = (redCharge / 5);
                        redCharge = 0;
                        this.bullet.fire();
                    }
                    if (this.getSpeed() > 0) {
                        if (this.getSpeed() <= 1 && this.getSpeed() > 0) {
                            this.changeSpeedBy(-(this.getSpeed()));
                        } else {
                            this.changeSpeedBy(-1);
                        }
                    }
                } // end checkKeys
                return ship1;
            } // end tank
            function Ship2() {
                ship2 = new Sprite(game, "space.png", 50, 25);
                ship2.setSpeed(0);
                ship2.setPosition(1400, 400);
                ship2.setBoundAction(BOUNCE);
                ship2.changeImgAngleBy(180);
                ship2.bullet = new BlueBullet(ship2);
                ship2.checkCollisions = function () {
                    if (ship2.collidesWith(asteroid1)) {
                        ship2.dy *= -1;
                        ship2.dx *= -1;
                        ship2.calcSpeedAngle();
                        ship2.imgAngle = ship2.moveAngle;
                        //prevents ship from getting stuck on asteroid bounce
                        ship2.changeSpeedBy(1);
                    }
                }
                ship2.checkKeys = function () {
                    if (ship2time.getElapsedTime() > 2) {
                        bluebullet.hide();
                    }
                    if (keysDown[K_LEFT]) {
                        this.changeImgAngleBy(-5);
                    }
                    if (keysDown[K_RIGHT]) {
                        this.changeImgAngleBy(5);
                        //this.changeAngleBy(10);
                    }
                    if (keysDown[K_UP]) {
                        if (this.getSpeed() < 30) {
                            this.addVector(this.getImgAngle(), 2);
                        }
                        // end if
                    }
                    if (keysDown[K_DOWN]) {
                        if (ship2time.getElapsedTime() > 2) {
                            if (blueCharge < 30) {
                                blueCharge++;
                            }
                        }
                    } else if (blueCharge != 0) {
                        blueBulletBounces = (blueCharge / 5);
                        blueCharge = 0;
                        this.bullet.fire();
                    }
                    if (this.getSpeed() > 0) {
                        if (this.getSpeed() <= 1 && this.getSpeed() > 0) {
                            this.changeSpeedBy(-(this.getSpeed()));
                        } else {
                            this.changeSpeedBy(-1);
                        }
                    }
                } // end checkKeys
                return ship2;
            } // end ship2
            /* function checkHit(){
             if (tankGreen.bullet.collidesWith(tankRed)){
             tankRed.reset();
             } // end if
             } // end checkHit **/
             function gameEnd(){
                 bgmmp3.stop();
                 hitmarker.play();
                 var pause1 = new Timer();
                 pause1.reset();
                 while(true){
                 if(pause1.getElapsedTime() > 1.5){
                     y = Math.floor(Math.random() * (winSounds.length));
                   
                    console.log(y);
                    winSounds[y].play();
                    break;
                 }
                 document.getElementById("retry").disabled = false;
             }
                 
             }
            function init() {
                //begin the bgm
                buildSounds();
                
                try{
                    bgmmp3.stop();
                }catch(err){
                    
                }
                
                game = new Scene();
                game.setSize(1600, 800);
                gameStart();
                background = new Sprite(game, "background.png", 1600, 800);
                background.setSpeed(0);
                background.setPosition(800, 400);
                game.start();
            } // end init
            function gameStart(){
                ship1 = new Ship1();
                ship2 = new Ship2();
                asteroid1 = new asteroid();
                bgmloop =  new Timer();
                bgmloop.reset();
                bgmmp3.play();
                document.getElementById("retry").disabled = true;
            }
            function update() {
                if(bgmloop.getElapsedTime() > 215){
                    bgmmp3.play();
                    bgmogg.play();
                    bgmloop.reset();
                }
                game.clear();

                ship1.checkKeys();
                ship2.checkKeys();
                ship1.checkCollisions();
                ship2.checkCollisions();
                redbullet.checkCollisions();
                bluebullet.checkCollisions();

                background.update();
                redbullet.update();
                bluebullet.update();
                asteroid1.update();
                ship1.update();
                ship2.update();
            } // end update
        </script>
    </head>
    <body onload = "init()">
        <p style="text-align: center;">
            <button id="instructions"
                    type="button"
                    onclick="alert('Instructions:\n\
\n\
Player One\n\
W - Apply thrust\n\
A,D - Rotate Cruiser\n\
S - shoot (hold to charge)\n\
\n\
Player Two\n\
Up arrow - Apply thrust\n\
Left arrow, Right arrow - Rotate Cruiser\n\
Down arrow - shoot (hold to charge)\n\
\n\
Charge Shots longer to allow them to bounce more!\n\
')"
                    >Instructions</button>
            <button id ="retry"
                    type ="button"
                    onclick ="gameStart()"
                    disabled>
                     New Game
            </button>
        </p>
    </body>
</html>