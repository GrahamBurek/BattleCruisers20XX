<!DOCTYPE HTML>
<html lang="en-US">
    <head>
        <meta charset="UTF-8">
        <title>Battle Cruisers 20XX</title>
        <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
        <link rel="icon" href="images/favicon.ico" type="image/x-icon">
        <!--Set up CSS for game. -->
        <style>
            body {
                background-color: #6699ff;
            }

            #instructions {
                width: 10em; height: 5em; font-size: 22px;
            }
            #retry {
                width: 10em; height: 5em; font-size: 22px;
            }

            #bar1 {
                text-align: left;
            }
            #bar2 {
                text-align: right;
            }
            #buttons {
                text-align:center;
            }

            canvas {
                padding-left: 0;
                padding-right: 0;
                margin-left: auto;
                margin-right: auto;
                display: block;
                width: 1600px;
            }
        </style>
        <script type="text/javascript"
        src = "simpleGame.js"></script>
        <script type="text/javascript">

            // music variables
            var trackNum;
            var lasermp3;
            var laserogg;
            var bgms;
            var winSounds;
            var hitmarker;  
            var randomWinSound = 0;
            
            // sprite declarations
            var ship1;
            var ship2;
            var background;
            var redbullet;
            var bluebullet;
            var asteroids;
            
            // Timer declarations
            var ship1time;
            var ship2time;
           
            // bullet variables
            var redBulletBounces = 0;
            var blueBulletBounces = 0;
            var redCharge = 0.0;
            var blueCharge = 0.0;
            var progressBar1 = document.getElementById("progressbar1");
            var progressBar2 = document.getElementById("progressbar2");
            
            // scene
            var game;
            
            //constants
            var SHIP_LEFT_TURN_SPEED = -5;
            var SHIP_RIGHT_TURN_SPEED = 5;
            var MAX_BULLET_CHARGE = 30.0;
            var SONG_1_LENGTH = 215;
            var SONG_2_LENGTH = 237;
            var SONG_3_LENGTH = 189;

            // Create all the sounds at the beginning of the game, used in init() function.
            buildSounds = function () {
                bgms = new Array(new Sound("music/bgm1.mp3"),new Sound("music/bgm2.mp3"),new Sound("music/bgm3.mp3"));
                lasermp3 = new Sound("music/laser.mp3");
                laserogg = new Sound("music/laser.ogg");
                hitmarker = new Sound("music/hitmarker.mp3");
                
                // array of "win sounds" (played when a ship is destroyed).)
                winSounds = new Array(new Sound("music/airporn.mp3"), new Sound("music/barely.mp3"),
                        new Sound("music/i_eat_pears.mp3"), new Sound("music/illuminati_confirmed.mp3"),
                        new Sound("music/im_legally_blind.mp3"), new Sound("music/im_not_a_rapper.mp3"),
                        new Sound("music/my_name_jeff.mp3"), new Sound("music/oh_baby_a_triple.mp3"),
                        new Sound("music/really_nigga.mp3"), new Sound("music/smoke_weed_everyday.mp3"),
                        new Sound("music/u_wot_m8.mp3"), new Sound("music/whatcha_say.mp3"), new Sound("music/where_dey_at_doe.mp3"),
                        new Sound("music/wow.mp3"), new Sound("music/singsing.mp3"));
            };

            function RedBullet(owner) {
                
                ship1time = new Timer();
                redbullet = new Sprite(game, "images/redbullet.png", 60, 30);
                
                // owner is the ship owning this bullet
                redbullet.owner = owner;
                redbullet.hide();
                redbullet.setBoundAction(BOUNCE);

                redbullet.fire = function () {
                    lasermp3.play();
                    laserogg.play();
                    ship1time.reset();
                    this.setPosition(this.owner.x, this.owner.y);
                    this.setMoveAngle(this.owner.getImgAngle());
                    this.setImgAngle(this.owner.getImgAngle());
                    this.setSpeed(40);
                    this.show();
                };
                
                redbullet.checkCollisions = function () {
                    for (var i = 0; i < asteroids.length; i++) {
                        if (redbullet.collidesWith(asteroids[i])) {
                            redbullet.dy *= -1;
                            redbullet.dx *= -1;
                            redbullet.calcSpeedAngle();

                            redBulletBounces--;
                            // remove the bullet from the scene if it has no more bounces.
                            if (redBulletBounces <= 0) {
                                redbullet.hide();
                            }
                        }
                    }
                    if (redbullet.collidesWith(ship2)) {
                        ship2.hide();
                        gameEnd();
                    }
                };
                
                // Overriding checkBounds function from simpleGame.js
                redbullet.checkBounds = function() {

                    offRight = false;
                    offLeft = false;
                    offTop = false;
                    offBottom = false;

                    if (this.x > rightBorder) {
                        offRight = true;
                    }

                    if (this.x < leftBorder) {
                        offLeft = true;
                    }

                    if (this.y > bottomBorder) {
                        offBottom = true;
                    }

                    if (this.y < 0) {
                        offTop = true;
                    }

                    if (this.boundAction === BOUNCE) {
                        if (offTop || offBottom) {
                            this.dy *= -1;
                            this.calcSpeedAngle();
                           
                            if (this.visible === true) {
                                redBulletBounces--;
                                if (redBulletBounces <= 0) {
                                    redbullet.hide();
                                }
                            }
                        }

                        if (offLeft || offRight) {
                            this.dx *= -1;
                            this.calcSpeedAngle();
                            this.imgAngle = this.moveAngle;
                            if (this.visible == true) {
                                redBulletBounces--;
                                if (redBulletBounces <= 0) {
                                    redbullet.hide();
                                }
                            }
                        }
                    }
                };
                return redbullet;
            } // end bullet

             function BlueBullet(owner) {
                
                ship2time = new Timer();
                bluebullet = new Sprite(game, "images/bluebullet.png", 60, 30);
                
                //owner is the ship owning this bullet
                bluebullet.owner = owner;
                bluebullet.hide();
                bluebullet.setBoundAction(BOUNCE);

                bluebullet.fire = function () {
                    lasermp3.play();
                    laserogg.play();
                    ship2time.reset();
                    this.setPosition(this.owner.x, this.owner.y);
                    this.setMoveAngle(this.owner.getImgAngle());
                    this.setImgAngle(this.owner.getImgAngle());
                    this.setSpeed(40);
                    this.show();
                };
                
                bluebullet.checkCollisions = function () {
                    for (var i = 0; i < asteroids.length; i++) {
                        if (bluebullet.collidesWith(asteroids[i])) {
                            bluebullet.dy *= -1;
                            bluebullet.dx *= -1;
                            bluebullet.calcSpeedAngle();

                            blueBulletBounces--;
                            // hide bullet if it has no more bounces.
                            if (blueBulletBounces <= 0) {
                                bluebullet.hide();
                            }

                        }
                    }
                    if (bluebullet.collidesWith(ship1)) {
                        ship1.hide();
                        gameEnd();
                    }
                };
                
                // Overriding checkBounds function from simpleGame.js.
                bluebullet.checkBounds = function () {

                    offRight = false;
                    offLeft = false;
                    offTop = false;
                    offBottom = false;

                    if (this.x > rightBorder) {
                        offRight = true;
                    }

                    if (this.x < leftBorder) {
                        offLeft = true;
                    }

                    if (this.y > bottomBorder) {
                        offBottom = true;
                    }

                    if (this.y < 0) {
                        offTop = true;
                    }

                    if (this.boundAction === BOUNCE) {
                        if (offTop || offBottom) {
                            this.dy *= -1;
                            this.calcSpeedAngle();
                           
                            if (this.visible === true) {
                                blueBulletBounces--;
                                if (blueBulletBounces <= 0) {
                                    bluebullet.hide();
                                }
                            }
                        }

                        if (offLeft || offRight) {
                            this.dx *= -1;
                            this.calcSpeedAngle();
                            this.imgAngle = this.moveAngle;
                            if (this.visible === true) {
                                blueBulletBounces--;
                                if (blueBulletBounces <= 0) {
                                    bluebullet.hide();
                                }
                            }
                        }
                    }
                };
                return bluebullet;
            }
            
            
            // Create all the asteroids for the map, used in init().
            function makeAsteroids() {
                
                // Create an array of asteroids
                asteroids = new Array(new Sprite(game, "images/asteroid1.png", 100, 100),
                        new Sprite(game, "images/asteroid2.png", 100, 100),
                        new Sprite(game, "images/asteroid3.png", 100, 100),
                        new Sprite(game, "images/asteroid4.png", 100, 100),
                        new Sprite(game, "images/asteroid1.png", 100, 100),
                        new Sprite(game, "images/asteroid2.png", 100, 100),
                        new Sprite(game, "images/asteroid3.png", 100, 100));

                // Place the asteroids
                for (var i = 0; i < asteroids.length; i++) {
                    asteroids[0].setPosition(400, 450);
                    asteroids[0].setSpeed(0);
                    asteroids[1].setPosition(700, 700);
                    asteroids[1].setSpeed(0);
                    asteroids[2].setPosition(200, 150);
                    asteroids[2].setSpeed(0);
                    asteroids[3].setPosition(1200, 100);
                    asteroids[3].setSpeed(0);
                    asteroids[4].setPosition(1500, 700);
                    asteroids[4].setSpeed(0);
                    asteroids[5].setPosition(800, 200);
                    asteroids[5].setSpeed(0);
                    asteroids[6].setPosition(1200, 450);
                    asteroids[6].setSpeed(0);
                }
            }

            function Ship1() {
                ship1 = new Sprite(game, "images/space.png", 75, 38);
                ship1.setSpeed(0);
                ship1.setPosition(100, 550);
                ship1.setBoundAction(BOUNCE);
                ship1.bullet = new RedBullet(ship1);
                
                ship1.checkCollisions = function () {
                    for (var i = 0; i < asteroids.length; i++) {
                        if (ship1.collidesWith(asteroids[i])) {
                            ship1.dy *= -1;
                            ship1.dx *= -1;
                            ship1.calcSpeedAngle();
                            ship1.imgAngle = ship1.moveAngle;
                            
                            // prevents ship from getting stuck on asteroid bounce
                            ship1.changeSpeedBy(5);
                        }
                    }
                };
                
                ship1.checkKeys = function () {
                    if (keysDown[K_A]) {
                        this.changeImgAngleBy(SHIP_LEFT_TURN_SPEED);
                    }
                    
                    if (keysDown[K_D]) {
                        this.changeImgAngleBy(SHIP_RIGHT_TURN_SPEED);
                    }
                    
                    if (keysDown[K_W]) {
                        ship1.changeImage("images/spacethrust.png");
                        if (this.getSpeed() < 20) {
                            this.addVector(this.getImgAngle(), 2);
                        }
                    }
                    else {
                        ship1.changeImage("images/space.png");
                    }
                    if (keysDown[K_S]) {
                        if (ship1time.getElapsedTime() > 2 && ship1.visible === true) {
                            if (redCharge < MAX_BULLET_CHARGE) {
                                redCharge++;
                                document.getElementById("progressbar1").value = redCharge;

                            }
                        }
                    } else if (redCharge != 0) {
                        redBulletBounces = (redCharge / 5);
                        redCharge = 0;
                        this.bullet.fire();
                        document.getElementById("progressbar1").value = 0;
                    }
                    // Slows down the ship when no key is pressed.
                    if (this.getSpeed() > 0) {
                        if (this.getSpeed() <= 1 && this.getSpeed() > 0) {
                            this.changeSpeedBy(-(this.getSpeed()));
                        } else {
                            this.changeSpeedBy(-1);
                        }
                    }
                } // end checkKeys
                
                
                // Override checkBounds function.
                ship1.checkBounds = function() {

                    offRight = false;
                    offLeft = false;
                    offTop = false;
                    offBottom = false;

                    if (this.x > rightBorder) {
                        offRight = true;
                    }

                    if (this.x < leftBorder) {
                        offLeft = true;
                    }

                    if (this.y > bottomBorder) {
                        offBottom = true;
                    }

                    if (this.y < 0) {
                        offTop = true;
                    }

                    if (this.boundAction === BOUNCE) {
                        if (offTop || offBottom) {
                            this.dy *= -1;
                            this.calcSpeedAngle();
                            this.imgAngle = this.moveAngle;
                            ship1.changeSpeedBy(5);
                        }

                        if (offLeft || offRight) {
                            this.dx *= -1;
                            this.calcSpeedAngle();
                            this.imgAngle = this.moveAngle;
                            ship1.changeSpeedBy(5);
                        }
                    }
                };
                
                return ship1;
            } // end ship1

            function Ship2() {
                ship2 = new Sprite(game, "images/space.png", 75, 38);
                ship2.setSpeed(0);
                ship2.setPosition(1400, 400);
                ship2.setBoundAction(BOUNCE);
                ship2.bullet = new BlueBullet(ship2);
                
                ship2.checkCollisions = function () {
                    for (var i = 0; i < asteroids.length; i++) {
                        if (ship2.collidesWith(asteroids[i])) {
                            ship2.dy *= -1;
                            ship2.dx *= -1;
                            ship2.calcSpeedAngle();
                            ship2.imgAngle = ship2.moveAngle;
                            //prevents ship from getting stuck on asteroid bounce
                            ship2.changeSpeedBy(5);
                        }
                    }
                }
                ship2.checkKeys = function () {
                    if (keysDown[K_LEFT]) {
                        this.changeImgAngleBy(SHIP_LEFT_TURN_SPEED);
                    }
                    if (keysDown[K_RIGHT]) {
                        this.changeImgAngleBy(SHIP_RIGHT_TURN_SPEED);
                    }
                    if (keysDown[K_UP]) {
                        ship2.changeImage("images/spacethrust.png");
                        if (this.getSpeed() < 20) {
                            this.addVector(this.getImgAngle(), 2);
                        }
                        // end if
                    } else {
                        ship2.changeImage("images/space.png");
                    }
                    if (keysDown[K_DOWN]) {
                        if (ship2time.getElapsedTime() > 2 && ship2.visible === true) {
                            if (blueCharge < MAX_BULLET_CHARGE) {
                                blueCharge++;
                                document.getElementById("progressbar2").value = blueCharge;
                            }
                        }
                    } else if (blueCharge !== 0) {
                        blueBulletBounces = (blueCharge / 5);
                        blueCharge = 0;
                        this.bullet.fire();
                        document.getElementById("progressbar2").value = 0;
                    }
                    // Slows down the ship when no key is pressed.
                    if (this.getSpeed() > 0) {
                        if (this.getSpeed() <= 1 && this.getSpeed() > 0) {
                            this.changeSpeedBy(-(this.getSpeed()));
                        } else {
                            this.changeSpeedBy(-1);
                        }
                    }
                } // end checkKeys
                
                // Override checkBounds function.
                ship2.checkBounds = function() {

                    offRight = false;
                    offLeft = false;
                    offTop = false;
                    offBottom = false;

                    if (this.x > rightBorder) {
                        offRight = true;
                    }

                    if (this.x < leftBorder) {
                        offLeft = true;
                    }

                    if (this.y > bottomBorder) {
                        offBottom = true;
                    }

                    if (this.y < 0) {
                        offTop = true;
                    }

                    if (this.boundAction === BOUNCE) {
                        if (offTop || offBottom) {
                            this.dy *= -1;
                            this.calcSpeedAngle();
                            this.imgAngle = this.moveAngle;
                            ship2.changeSpeedBy(5);
                        }

                        if (offLeft || offRight) {
                            this.dx *= -1;
                            this.calcSpeedAngle();
                            this.imgAngle = this.moveAngle;
                            ship2.changeSpeedBy(5);
                        }
                    }
                };
                
                return ship2;
            } // end ship2
           
            // Called when a ship is hit and destroyed by a bullet.
            function gameEnd() {
                bgms[trackNum].stop();
                hitmarker.play();
                var pause1 = new Timer();
                pause1.reset();
                while (true) {
                    if (pause1.getElapsedTime() > 1.5) {
                        randomWinSound = Math.floor(Math.random() * (winSounds.length));
                        winSounds[randomWinSound].play();
                        break;
                    }
                    // allow the new game button to be pressed.
                    document.getElementById("retry").disabled = false;
                }

            }
            
            function init() {
                // create sounds to use ingame
                buildSounds();
                
                // begin the bgm
                try {
                    bgms[trackNum].stop();
                } catch (err) {

                }

                game = new Scene();
                game.setSize(1600, 800);
                gameStart();
                background = new Sprite(game, "images/background.png", 1600, 800);
                background.setSpeed(0);
                background.setPosition(800, 400);
                game.start();
            } // end init
            
            
            function gameStart() {
                ship1 = new Ship1();
                ship2 = new Ship2();
                makeAsteroids();
                bgmloop = new Timer();
                bgmloop.reset();
                // Randomly picks a bgm.
                trackNum = (Math.floor((Math.random()*3)));
                bgms[trackNum].play();
                // Disables new game button until a ship is destroyed.
                document.getElementById("retry").disabled = true;
            }

            function updateAsteroids() {
                for (var i = 0; i < asteroids.length; i++) {
                    asteroids[i].update();
                }
            }

            function update() {
                // Loop the bgms based on the song length.
                if(trackNum === 0){
                if (bgmloop.getElapsedTime() > SONG_1_LENGTH) {
                    bgms[trackNum].play();
                    bgmloop.reset();
                }
            }
                if(trackNum === 1){
                    if (bgmloop.getElapsedTime() > SONG_2_LENGTH) {
                    bgms[trackNum].play();
                    bgmloop.reset();
                }
                }
                if(trackNum === 2){
                    if (bgmloop.getElapsedTime() > SONG_3_LENGTH) {
                    bgms[trackNum].play();
                    bgmloop.reset();
                }
                }
                game.clear();
                ship1.checkKeys();
                ship2.checkKeys();
                ship1.checkCollisions();
                ship2.checkCollisions();
                redbullet.checkCollisions();
                bluebullet.checkCollisions();
                redbullet.imgAngle = redbullet.moveAngle;
                bluebullet.imgAngle = bluebullet.moveAngle;
                background.update();
                redbullet.update();
                bluebullet.update();
                updateAsteroids();
                ship1.update();
                ship2.update();
            } // end update
        </script>
    </head>
    <body onload = "init()">
        <p style="text-align: center;">
        
        <div id="buttons">
            <button id="instructions"
                    type="button"
                    onclick="alert('Instructions:\n\
\n\
Player One\n\
W - Apply thrust\n\
A,D - Rotate Cruiser\n\
S - Shoot (hold to charge)\n\
\n\
Player Two\n\
Up arrow - Apply thrust\n\
Left arrow, Right arrow - Rotate Cruiser\n\
Down arrow - Shoot (hold to charge)\n\
\n\
Charge Shots longer to allow them to bounce more!\n\
')"
                    >Instructions</button>
            <button id ="retry"
                    type ="button"
                    onclick ="gameStart()"
                    disabled>
                New Game
            </button>
        </div>
        <div id="bar1">
            <progress id="progressbar1" value="0" max="30" ></progress>
        </div>
        <div id="bar2">
            <progress id="progressbar2" value="0" max="30"></progress>
        </div>
    </p>
</body>
</html>

